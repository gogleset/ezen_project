<!--
    @Filename: productDetail.html
    @Author: 정한슬 (seul5106@gmail.com)
    @description: 상품관리 상세페이지 html
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../../css/admin/layout.css">
    <link rel="stylesheet" href="../../css/admin/productDetail.css">
</head>

<body>
    <!-- 헤더입니다. -->
    <div data-init="../inc/admin-header.html"></div>
    <!-- 서브 타이틀 영역입니다. -->
    <div class="container">
        <div class="content-header">
            <h3 class="content-title pull-left">상품관리</h3>
            <span class="content-sub-title pull-right">홈-상품관리-상품상세</span>
        </div>
        <form class="clearfix prodContainer" enctype='multipart/form-data'>
            <div class="form-group">
                <div class="col-md-12">
                    <label for="classification">분류</label>
                    <div>
                        <select name="classification" id="prodOption">
                            <option class="prodSelect" value="">전체분류</option>
                            <option class="prodSelect" value="c&t">케이크&티라미슈</option>
                            <option class="prodSelect" value="b&p">빙수&파르페</option>
                            <option class="prodSelect" value="m&o">마카롱&오믈렛</option>
                            <option class="prodSelect" value="c&p">쿠키</option>
                            <option class="prodSelect" value="b">베이커리</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-5">
                    <div class="col-md-8 imageRender">
                        <label for="img" class="prodImage">상품 이미지</label>
                        <img src="" name="img" id="img" style="border:1px solid rgb(167, 163, 163)">
                    </div>
                    <!-- 상품 이미지를 전송합니다 -->
                    <form method="post">
                        <div>
                            <input type="file" id="prodFile" name="prodFile" accept=".jpg, .jpeg, .png">
                        </div>
                    </form>
                </div>
                <div class="col-md-5 product-info">
                    <div class="col-md-10">
                        <label for="product-name" class="col-md-4">상품명</label>
                        <input type="text" name="product-name" id="product-name" />
                    </div>
                    <div class="col-md-10">
                        <label for="sale-price" class="col-md-4">판매가격</label>
                        <input type="text" name="sale-price" id="sale-price" maxlength="10" />
                    </div>
                    <div class="col-md-10">
                        <label for="stock" class="col-md-4">재고</label>
                        <input type="text" name="stock" id="stock" maxlength="5" />
                    </div>
                </div>
            </div>


            <div class="form-group col-md-12">
                <label for="product-details" class="pull-left">부가설명</label>
                <textarea type="text" class="form-control" name="product-details" id="product-details"></textarea>
            </div>
            <div class="form-group col-md-12">
                <label for="nutrition-info">영양정보</label>
                <textarea type="text" class="form-control" name="nutrition-info" id="nutrition-info"></textarea>
            </div>
            <div class="form-group col-md-12">
                <label for="allergy-info" class="pull-left">알레르기 정보</label>
                <textarea type="text" class="form-control" name="allergy-info" id="allergy-info"></textarea>
            </div>

            <button class="btn btn-primary pull-right btn-admin-setting" id="cancel" type="button">취소</button>
            <button class="btn btn-primary pull-right btn-admin-setting" id="delete" type="button">삭제</button>
            <button class="btn btn-primary pull-right btn-admin-setting" id="save" type="button">저장
        </form>
    </div>



    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../assets/layout.js"></script>
    <script src="../../js/regex_helper.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const regexHelper = new RegexHelper();

        document.getElementById("save").addEventListener("click", async e => {
            e.preventDefault();

            // dropdown 객체
            const dropdown = document.querySelector("#prodOption");

            // 선택된 항목의 index --> <option>의 순서대로 0,1,2,3
            const choose = dropdown.selectedIndex;



            // 상품명
            const product_name = document.querySelector("#product-name").value;

            // 상품가격
            const product_price = document.querySelector("#sale-price").value.trim();

            // 재고 수량
            const product_stock = document.querySelector("#stock").value.trim();

            // 이미지파일 소스
            const product_img = document.querySelector("#img").getAttribute("src");

            // 선택된 option의 value 및 카테고리 
            const product_categorie = dropdown[choose].value;

            // 상품 상세설명
            const product_desc = document.querySelector("#product-details").value;
            
            // 상품 영양정보
            const product_nutri = document.querySelector("#nutrition-info").value;

            // 상품 알레르기 정보
            const product_allergy = document.querySelector("#allergy-info").value;
            
            if (!product_categorie) {
                Swal.fire({
                    text: "카테고리 값을 입력해주세요",
                    icon: 'error',
                    confirmButtonText: '확인'
                });
                return false;
            }

            if (!product_img) {
                Swal.fire({
                    text: "상품 이미지를 입력해주세요",
                    icon: 'error',
                    confirmButtonText: '확인'
                });
                return false;
            }

            if (!regexHelper.value("#product-name", "상품명을 입력하세요.")) {
                return false;
            }

            if (!regexHelper.value("#sale-price", "판매가격을 입력하세요.")) {
                return false;
            }
            if (!regexHelper.value("#stock", "재고를 입력하세요.")) {
                return false;
            }

            if (!regexHelper.value("#product-details", "부가설명을 입력하세요.")) {
                return false;
            }
            if (!regexHelper.value("#nutrition-info", "영양 정보를 입력하세요.")) {
                return false;
            }
            if (!regexHelper.value("#allergy-info", "알레르기 정보를 입력하세요.")) {
                return false;
            }
            // 유효성 검사 끝난 후 백엔드 전송
            try {
                await axios.post('/product', {
                    product_name:product_name,
                    product_price:product_price,
                    product_stock:product_stock,
                    product_img:product_img,
                    product_categorie:product_categorie,
                    product_desc:product_desc,
                    product_nutri:product_nutri,
                    product_allergy:product_allergy,
                })
            } catch (e) {
                Swal.fire({
                    text: `${e} 전송에 실패했습니다.`,
                    icon: 'error',
                    confirmButtonText: '확인'
                });
            }

        })

        // 파일 업로드를 감지합니다.
        document.querySelector("#prodFile").addEventListener("change", e => {

            e.preventDefault();
            let img = document.querySelector("#img");

            img.src = URL.createObjectURL(e.currentTarget.files[0]);
            console.log(img);
            imgUrl = img.src
            console.log(imgUrl);
        });
        // 삭제버튼 이벤트
        document.getElementById("delete").addEventListener("click", e => { })
        // 취소버튼 이벤트
        document.getElementById("cancel").addEventListener("click", e => { })


    </script>
</body>

</html>