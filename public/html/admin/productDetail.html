<!--
    @Filename: productDetail.html
    @Author: 정한슬 (seul5106@gmail.com)
    @description: 상품관리 상세페이지 html
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../../css/admin/layout.css">
    <link rel="stylesheet" href="../../css/admin/productDetail.css">
</head>

<body>
    <!-- 헤더입니다. -->
    <div data-init="../inc/admin-header.html"></div>
    <!-- 서브 타이틀 영역입니다. -->
    <div class="container">
        <div class="content-header">
            <h3 class="content-title pull-left">상품관리</h3>
            <span class="content-sub-title pull-right">홈-상품관리-상품상세</span>
        </div>


        <form class="clearfix prodContainer" enctype='multipart/form-data' action='/product' method="post"
            id="formData">
            <div class="form-group">
                <div class="col-md-12">
                    <label for="classification">분류</label>
                    <div>
                        <select name="productCategorie" id="productCategorie">
                            <option class="prodSelect" value="">전체분류</option>
                            <option class="prodSelect" value="c&t">케이크&티라미슈</option>
                            <option class="prodSelect" value="b&p">빙수&파르페</option>
                            <option class="prodSelect" value="m&o">마카롱&오믈렛</option>
                            <option class="prodSelect" value="c&p">쿠키</option>
                            <option class="prodSelect" value="b">베이커리</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-5">
                    <div class="col-md-8 imageRender">
                        <label for="img" class="prodImage">상품 이미지</label>
                        <img src="" name="img" id="img" style="border:1px solid rgb(167, 163, 163)">
                    </div>
                    <!-- 상품 이미지를 전송합니다 -->
                    <input type="file" id="profileImg" name="profileImg" accept=".jpg, .jpeg, .png">
                </div>
                <div class="col-md-5 product-info">
                    <div class="col-md-10">
                        <label for="productName" class="col-md-4">상품명</label>
                        <input type="text" name="productName" id="productName" />
                    </div>
                    <div class="col-md-10">
                        <label for="sale-price" class="col-md-4">판매가격</label>
                        <input type="text" name="productPrice" id="productPrice" maxlength="10" />
                    </div>
                    <div class="col-md-10">
                        <label for="stock" class="col-md-4">재고</label>
                        <input type="text" name="productStock" id="productStock" maxlength="11" />
                    </div>
                </div>
            </div>


            <div class="form-group col-md-12">
                <label for="product-details" class="pull-left">부가설명</label>
                <input type="text" class="form-control" name="productDesc" id="productDesc"></input>
            </div>
            <div class="form-group col-md-12">
                <label for="productNutri">영양정보</label>
                <input type="text" class="form-control" name="productNutri" id="productNutri"></input>
            </div>
            <div class="form-group col-md-12">
                <label for="allergy-info" class="pull-left">알레르기 정보</label>
                <input type="text" class="form-control" name="productAllergy" id="productAllergy"></input>
            </div>
            <button class="btn btn-primary pull-right btn-admin-setting" id="cancel" type="button">취소</button>
            <button class="btn btn-primary pull-right btn-admin-setting" id="delete" type="reset">삭제</button>
            <button class="btn btn-primary pull-right btn-admin-setting" type="submit" id="save">저장</button>
        </form>
    </div>



    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../assets/layout.js"></script>
    <script src="../../js/regex_helper.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const regexHelper = new RegexHelper();
        let imgUrl = null;

        document.querySelector("#formData").addEventListener("submit", async e => {

            e.preventDefault();

            const dropdown = document.querySelector("#productCategorie");

            // 선택된 항목의 index --> <option>의 순서대로 0,1,2,3
            const choose = dropdown.selectedIndex;

            // 이미지파일 소스
            const productImg = document.querySelector("#img").getAttribute("src");

            // 선택된 option의 value 및 카테고리 
            const productCategorie = dropdown[choose].value;


            const productName = document.querySelector("#productName").value;
            console.log(productName);
            const productPrice = document.querySelector("#productPrice").value;
            const productStock = document.querySelector("#productStock").value;
            const productDesc = document.querySelector("#productDesc").value;
            const productNutri = document.querySelector("#productNutri").value;
            const productAllergy = document.querySelector("#productAllergy").value;

            if (!productCategorie) {
                Swal.fire({
                    text: "카테고리 값을 입력해주세요",
                    icon: 'error',
                    confirmButtonText: '확인'
                });
                return false;
            }

            if (!productImg) {
                Swal.fire({
                    text: "상품 이미지를 입력해주세요",
                    icon: 'error',
                    confirmButtonText: '확인'
                });
                return false;
            }

            if (!regexHelper.value("#productName", "상품명을 입력하세요.")) {
                return false;
            }
            if (!regexHelper.max_length("#productName", 30, "최대 글자수를 넘겼습니다.")) {
                return false;
            }


            if (!regexHelper.value("#productPrice", "판매가격을 입력하세요.")) {
                return false;
            }
            if (!regexHelper.num("#productPrice", "숫자로 입력하세요.")) {
                return false;
            }
            if (!regexHelper.max_length("#productPrice", 11, "최대 글자수를 넘겼습니다.")) {
                return false;
            }




            if (!regexHelper.value("#productStock", "재고를 입력하세요.")) {
                return false;
            }
            if (!regexHelper.num("#productStock", "숫자로 입력하세요.")) {
                return false;
            }
            if (!regexHelper.max_length("#productStock", 11, "최대 글자수를 넘겼습니다.")) {
                return false;
            }



            if (!regexHelper.value("#productDesc", "부가설명을 입력하세요.")) {
                return false;
            }
            if (!regexHelper.max_length("#productDesc", 255, "최대 글자수를 넘겼습니다.")) {
                return false;
            }

            if (!regexHelper.value("#productNutri", "영양 정보를 입력하세요.")) {
                return false;
            }
            if (!regexHelper.max_length("#productNutri", 255, "최대 글자수를 넘겼습니다.")) {
                return false;
            }
            if (!regexHelper.value("#productAllergy", "알레르기 정보를 입력하세요.")) {
                return false;
            }
            if (!regexHelper.max_length("#productAllergy", 255, "최대 글자수를 넘겼습니다.")) {
                return false;
            }
            



            let formData = new FormData();
            // 폼 데이터를 넘깁니다.
            formData.append('photo', imgUrl)
            formData.append('productName', productName)
            formData.append('productPrice', productPrice)
            formData.append('productStock', productStock)
            formData.append('productCategorie', productCategorie)
            formData.append('productDesc', productDesc)
            formData.append('productNutri', productNutri)
            formData.append('productAllergy', productAllergy)
            
            try {
                // await axios.post('/product', formData, {

                // })
                await axios.post('/product', formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data',
                    }
                })
            } catch (e) {
                console.log(e);
            }

        })

        // 파일 업로드를 감지합니다.
        document.querySelector("#profileImg").addEventListener("change", e => {

            e.preventDefault();
            let img = document.querySelector("#img");
            if (!e.currentTarget.files[0]) {
                img.src = ""
                return;
            } else {
                img.src = URL.createObjectURL(e.currentTarget.files[0]);
            }
            imgUrl = e.currentTarget.files[0]
            console.log(imgUrl);
        });
        // 삭제버튼 이벤트
        document.getElementById("delete").addEventListener("click", e => { })
        // 취소버튼 이벤트
        document.getElementById("cancel").addEventListener("click", e => { })


    </script>
</body>

</html>